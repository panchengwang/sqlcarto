---------------------------------------------------------------------------
--
-- SQLCarto - 
-- Authors:
--      Pancheng Wang           sqlcarto@163.com
---------------------------------------------------------------------------

--
-- 
--

#include "../postgis/sqldefines.h"

-- INSTALL VERSION: POSTGIS_LIB_VERSION


--  Function    :   sqlcarto_info
--  Parameter   :  
--  Result      :   The basic infomartion of sqlcarto: version, authors and contact ways.  
create or replace function sqlcarto_info() returns json as 
$$
  select '{
      "extension" : "SQLCarto",
      "version" : "1.0",
      "authors" : ["pcwang","Pancheng Wang","wang_wang_lao","麓山老将"],
      "email": "sqlcarto@163.com"
    }'::json;
$$
language 'sql';




--  Function    :   sqlcarto_version
--  Parameter   :  
--  Result      :   Same as sqlcarto_info.  
create or replace function sqlcarto_version() returns json as 
$$
  select sqlcarto_info();
$$
language 'sql';




--  Function    :   sqlcarto_version
--                  Get rid of character "-" of a uuid.
--  Parameter   :  
--  Result      :   A uuid like string which is remove character "-" of the uuid.  
create or replace function sc_uuid() returns text as
$$
  select replace(gen_random_uuid()::text,'-','');
$$
language 'sql';





-- Sqlcarto configuration table 
create table sc_configuration(
    key_name varchar primary key,
    key_value varchar default '',
    description varchar default '' not null
);
insert into sc_configuration(key_name,key_value, description)
values
    ('EMAIL_USER','sqlcartotest@126.com','email of sender'),
    ('EMAIL_PASSWORD','SCUGOXHGWAEZUEQH','email password'),
    ('EMAIL_SMTP','smtps://smtp.126.com:465','smtp server');
-- values
--     ('EMAIL_USER','','email of sender'),
--     ('EMAIL_PASSWORD','','email password'),
--     ('EMAIL_SMTP','','smtp server');
--     'sqlcartotest@126.com',
--     'sqlcartotest@126.com',
--     '测试一下',
--     '这是一个从postgresql sqlcarto扩展发送过来的测试邮件',
--     'smtps://smtp.126.com:465',
--     'SCUGOXHGWAEZUEQH'




--  Function    :   sc_get_configuration
--                  Get configuration of a key.
--  Parameter   :  
--                  keyname     
--  Result      :   Configuration of a key. 
create or replace function sc_get_configuration(kename varchar) returns varchar as
$$
    select key_value from sc_configuration where key_name = $1;
$$ language 'sql';




--  Function    :   sc_generate_random_string
--                  Create a random string which character must be contained in some special character set.
--                  The len of the random string is specified by len.
--  Parameter   :  
--                  seedstr     The character set used to generate a random string.
--                  len         Length of random string.      
--  Result      :   A random string 
create or replace function sc_generate_random_string(seedstr varchar, len integer)
returns varchar as
$$
    select array_to_string(
        array(
            select 
                substring(
                    $1 
                    FROM 
                    (ceil(random()*length($1)))::int 
                    FOR 1
                ) 
            FROM 
             generate_series(1, $2)
        ), ''
    );
$$
language 'sql';



--  Function    :   sc_generate_code
--                  Create a random string which character must be contained in alphabetical set (ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789).
--                  The length of the random string is specified by len.
--  Parameter   :  
--                  len         Length of random string.      
--  Result      :   A random string 
create or replace function sc_generate_code(len integer) returns varchar as 
$$
    select sc_generate_random_string(
        'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789',
        $1
    );
$$ language sql;



--  Function    :   sc_generate_token
--                  Create a random string to be used as a token.
--  Parameter   :  
--                  len         Length of code, which must be greater than 32.      
--  Result      :   The conbination of a random string and an uuid. 
create or replace function sc_generate_token(len integer) returns varchar as
$$
    select sc_generate_random_string(
        'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789',$1-32) || 
        sc_uuid();
$$ language 'sql';



-- ---------------------------------------------------------------
-- 地图瓦片工具
-- ---------------------------------------------------------------


CREATE OR REPLACE FUNCTION tile_in(cstring)
	RETURNS tile
	AS 'MODULE_PATHNAME','tile_in'
	LANGUAGE 'c' IMMUTABLE STRICT;

CREATE OR REPLACE FUNCTION tile_out(tile)
	RETURNS cstring
	AS 'MODULE_PATHNAME','tile_out'
	LANGUAGE 'c' IMMUTABLE STRICT;


-- Availability: 3.4.2
CREATE TYPE tile (
   internallength = 12,
   input = tile_in,
   output = tile_out,
   alignment = int4
);

-- 瓦片转换成经纬度，左上角坐标
CREATE OR REPLACE FUNCTION sc_tile_to_lonlat(tile)
RETURNS geometry
AS 'MODULE_PATHNAME','tile_to_lonlat'
LANGUAGE C IMMUTABLE STRICT;

-- 经纬度转换成瓦片
CREATE OR REPLACE FUNCTION sc_lonlat_to_tile(geometry,integer)
RETURNS tile
AS 'MODULE_PATHNAME','lonlat_to_tile'
LANGUAGE C IMMUTABLE STRICT;

CREATE OR REPLACE FUNCTION sc_x(tile)
RETURNS integer
AS 'MODULE_PATHNAME','tile_x'
LANGUAGE C IMMUTABLE STRICT;

CREATE OR REPLACE FUNCTION sc_set_x(tile,integer)
RETURNS tile
AS 'MODULE_PATHNAME','tile_set_x'
LANGUAGE C IMMUTABLE STRICT;

CREATE OR REPLACE FUNCTION sc_y(tile)
RETURNS integer
AS 'MODULE_PATHNAME','tile_y'
LANGUAGE C IMMUTABLE STRICT;

CREATE OR REPLACE FUNCTION sc_set_y(tile,integer)
RETURNS tile
AS 'MODULE_PATHNAME','tile_set_y'
LANGUAGE C IMMUTABLE STRICT;

CREATE OR REPLACE FUNCTION sc_z(tile)
RETURNS integer
AS 'MODULE_PATHNAME','tile_z'
LANGUAGE C IMMUTABLE STRICT;

CREATE OR REPLACE FUNCTION sc_set_z(tile,integer)
RETURNS tile
AS 'MODULE_PATHNAME','tile_set_z'
LANGUAGE C IMMUTABLE STRICT;

-- 根据缩放级别计算分辨率
-- tilesize为瓦片的图像宽/高，一般为256像素
-- 为适应高清屏幕，现在的地图瓦片已经由512像素大小的了
-- 注意此分辨率为一个像素代表Web墨卡托坐标系（不是WGS84！）下的长度
create or replace function sc_get_resolution_of_zoom_level(z integer, tilesize integer) returns float8
as
$$
select
    (st_x(st_transform(sc_tile_to_lonlat(('TILE(1,0,' || $1 || ')')::tile),3857))
    - st_x(st_transform(sc_tile_to_lonlat(('TILE(0,0,' || $1 || ')')::tile),3857)))/$2
  ;
$$
language 'sql';


-- 根据缩放级别计算分辨率
-- 缺省采用256像素的瓦片大小
-- 注意此分辨率为一个像素代表Web墨卡托坐标系（不是WGS84！）下的长度
CREATE OR REPLACE FUNCTION sc_get_resolution_of_zoom_level(z integer) returns float8 AS
$$
  select sc_get_resolution_of_zoom_level($1,256);
$$
LANGUAGE 'sql';


-- 得到所有的分辨率
-- 瓦片大小为256
CREATE OR REPLACE FUNCTION sc_get_resolutions_of_all_zoom_levels(maxlevel integer)
RETURNS setof float8 as
$$
  select
    sc_get_resolution_of_zoom_level(A.z) as resolution
  from
    (select generate_series(0,$1) as z) as A;
$$
LANGUAGE 'sql';

-- 得到所有的分辨率
-- 瓦片大小为256
-- 最多23级
CREATE OR REPLACE FUNCTION sc_get_resolutions_of_all_zoom_levels()
RETURNS setof float8 as
$$
  select sc_get_resolutions_of_all_zoom_levels(23);
$$
LANGUAGE 'sql';

-- Send mail module

-- Function     :  sc_send_mail
-- Parameters   :   
--      sender      email address of sender
--      reciever    email address of reciver
--      title       email title
--      content     email content
--      smtp        smtp server
--      password    password of sender email
--                  Notes: Sometimes the password is not the password to login the email.
--                      For example, to send a email, 126,163 smtp server request a special password which is notified when the smtp email sending service was configured.
create or replace function sc_send_mail(
    sender varchar, 
    reciever varchar, 
    subject varchar, 
    content text,
    smtp varchar,
    password varchar
) 
returns boolean 
AS 'MODULE_PATHNAME','sc_send_mail'
LANGUAGE C IMMUTABLE STRICT;


-- 函数：sc_send_mail
-- 参数:    reciever 接收者信箱
--          title 邮件标题
--          content 邮件内容
create or replace function sc_send_mail(
    reciever varchar, 
    subject varchar, 
    content text
) 
returns boolean AS 
$$
    select sc_send_mail(
        sc_get_configuration('EMAIL_USER'),
        $1,
        $2,
        $3,
        sc_get_configuration('EMAIL_SMTP'),
        sc_get_configuration('EMAIL_PASSWORD')
    );
$$ language 'sql';



create or replace function sc_send_email(
    sender varchar, 
    reciever varchar, 
    subject varchar, 
    content text,
    smtp varchar,
    password varchar
) 
returns boolean AS
$$
    select sc_send_mail($1,$2,$3,$4,$5,$6);
$$ LANGUAGE 'sql';


create or replace function sc_send_email(
    reciever varchar, 
    subject varchar, 
    content text
) 
returns boolean AS
$$
    select sc_send_mail($1,$2,$3);
$$ LANGUAGE 'sql';




-- ---------------------------------------------------------------
-- 中国国内特殊坐标系转换工具
-- ---------------------------------------------------------------

-- Availability: 3.4.2
-- 将gcj02（火星坐标系）转换到百度坐标系
CREATE OR REPLACE FUNCTION sc_gcj02_to_bd09(geometry)
RETURNS geometry
AS 'MODULE_PATHNAME','gcj02_to_bd09'
LANGUAGE C IMMUTABLE STRICT;


-- Availability: 3.4.2
-- 将百度坐标系转换到gcj02（火星坐标系）
CREATE OR REPLACE FUNCTION sc_bd09_to_gcj02(geometry)
RETURNS geometry
AS 'MODULE_PATHNAME','bd09_to_gcj02'
LANGUAGE C IMMUTABLE STRICT;

-- Availability: 3.4.2
-- 将WGS84坐标转换到gcj02（火星坐标系）
CREATE OR REPLACE FUNCTION sc_wgs84_to_gcj02(geometry)
RETURNS geometry
AS 'MODULE_PATHNAME','wgs84_to_gcj02'
LANGUAGE C IMMUTABLE STRICT;

-- Availability: 3.4.2
-- 将gcj02（火星坐标系）转换到WGS84坐标
CREATE OR REPLACE FUNCTION sc_gcj02_to_wgs84(geometry)
RETURNS geometry
AS 'MODULE_PATHNAME','gcj02_to_wgs84'
LANGUAGE C IMMUTABLE STRICT;

-- Availability: 3.4.2
-- 将百度坐标系转换到WGS84
CREATE OR REPLACE FUNCTION sc_bd09_to_wgs84(geometry)
RETURNS geometry
AS 'MODULE_PATHNAME','bd09_to_wgs84'
LANGUAGE C IMMUTABLE STRICT;

-- Availability: 3.4.2
-- 将WGS84转换到百度坐标系
CREATE OR REPLACE FUNCTION sc_wgs84_to_bd09(geometry)
RETURNS geometry
AS 'MODULE_PATHNAME','wgs84_to_bd09'
LANGUAGE C IMMUTABLE STRICT;




-- Availability: 3.4.2
CREATE OR REPLACE FUNCTION sc_symbol_in(cstring)
	RETURNS symbol
	AS 'MODULE_PATHNAME','SYMBOL_in'
	LANGUAGE 'c' IMMUTABLE STRICT PARALLEL SAFE;

-- Availability: 3.4.2
CREATE OR REPLACE FUNCTION sc_symbol_out(symbol)
	RETURNS cstring
	AS 'MODULE_PATHNAME','SYMBOL_out'
	LANGUAGE 'c' IMMUTABLE STRICT PARALLEL SAFE;

-- Availability: 3.4.2
CREATE TYPE symbol (
	internallength = variable,
	input = sc_symbol_in,
	output = sc_symbol_out,
	alignment = double,
	storage = main
);

-- Availability: 3.4.2
CREATE OR REPLACE FUNCTION sc_symbol_as_image(symbol,text,float8)
	RETURNS bytea
	AS 'MODULE_PATHNAME','sc_symbol_as_image'
	LANGUAGE 'c' IMMUTABLE STRICT PARALLEL SAFE;

-- Availability: 3.4.2
CREATE OR REPLACE FUNCTION sc_symbol_as_image(symbol,text,float8,float8)
	RETURNS bytea
	AS 'MODULE_PATHNAME','sc_symbol_as_image_with_size'
	LANGUAGE 'c' IMMUTABLE STRICT PARALLEL SAFE;

  
-- Availability: 3.4.2 
-- 预定义好的地图符号postgres 
-- 地图符号中的线宽、点划线中的dash单位均为毫米 
-- 地图符号的定位坐标则为归一化的数值， 如圆心坐标、圆半径等 
-- 地图符号中的角度坐标为度，如弧的开始、结束角度，旋转角度 
create table sc_symbols( 
    id varchar(32) default sc_uuid(),       -- 
    english varchar(32),                    -- 英文名 
    chinese varchar(32),                    -- 中文名 
    sym symbol not null                     -- 地图符号 
); 

insert into sc_symbols(english, chinese, sym) values('0','0','
{
    "offset": {
        "x": 0,
        "y": 0
    },
    "size": 5,
    "shapes": [
        {
            "type": "path",
            "stroke": {
                "color": {
                    "alpha": 255,
                    "red": 0,
                    "green": 0,
                    "blue": 255
                },
                "width": 0.2,
                "dashoffset": 0,
                "dashes": [
                    1.0,
                    0
                ],
                "cap": "butt",
                "join": "miter",
                "miter": 10.0
            },
            "fill": {
                "type": "solid",
                "color": {
                    "alpha": 127,
                    "red": 255,
                    "green": 0,
                    "blue": 0
                }
            },
            "subpaths": [
                {
                    "type": "circle",
                    "center": {
                        "x": -0,
                        "y": -0
                    },
                    "radius": 0.8
                },
                {
                    "type": "text",
                    "text": "5",
                    "fontfamily": "SimSun",
                    "fontsize": 0.8,
                    "anchor": {
                        "x": 0.0,
                        "y": 0
                    },
                    "weight": "bold",
                    "slant": "normal",
                    "horizontalalign": "center",
                    "verticalalign": "middle",
                    "rotate": 0,
                    "ispath": true
                }
            ]
        }
    ]
}');

insert into sc_symbols(english, chinese, sym) values('0','〇','
{
    "offset": {
        "x": 0,
        "y": 0
    },
    "size": 5,
    "shapes": [
        {
            "type": "path",
            "stroke": {
                "color": {
                    "alpha": 255,
                    "red": 0,
                    "green": 0,
                    "blue": 255
                },
                "width": 0.2,
                "dashoffset": 0,
                "dashes": [
                    1.0,
                    0
                ],
                "cap": "butt",
                "join": "miter",
                "miter": 10.0
            },
            "fill": {
                "type": "solid",
                "color": {
                    "alpha": 127,
                    "red": 255,
                    "green": 0,
                    "blue": 0
                }
            },
            "subpaths": [
                {
                    "type": "circle",
                    "center": {
                        "x": -0,
                        "y": -0
                    },
                    "radius": 0.8
                }
            ]
        },
        {
            "type": "path",
            "stroke": {
                "color": {
                    "alpha": 255,
                    "red": 255,
                    "green": 255,
                    "blue": 255
                },
                "width": 0.2,
                "dashoffset": 0,
                "dashes": [
                    1.0,
                    0
                ],
                "cap": "butt",
                "join": "miter",
                "miter": 10.0
            },
            "fill": {
                "type": "solid",
                "color": {
                    "alpha": 255,
                    "red": 255,
                    "green": 255,
                    "blue": 255
                }
            },
            "subpaths": [
                {
                    "type": "text",
                    "text": "〇",
                    "fontfamily": "Noto Sans SC",
                    "fontsize": 0.6,
                    "anchor": {
                        "x": 0.0,
                        "y": 0
                    },
                    "weight": "bold",
                    "slant": "normal",
                    "horizontalalign": "center",
                    "verticalalign": "middle",
                    "rotate": 0,
                    "ispath": false
                }
            ]
        }
    ]
}');

insert into sc_symbols(english, chinese, sym) values('10','十','
{
    "offset": {
        "x": 0,
        "y": 0
    },
    "size": 5,
    "shapes": [
        {
            "type": "path",
            "stroke": {
                "color": {
                    "alpha": 255,
                    "red": 0,
                    "green": 0,
                    "blue": 255
                },
                "width": 0.2,
                "dashoffset": 0,
                "dashes": [
                    1.0,
                    0
                ],
                "cap": "butt",
                "join": "miter",
                "miter": 10.0
            },
            "fill": {
                "type": "solid",
                "color": {
                    "alpha": 127,
                    "red": 255,
                    "green": 0,
                    "blue": 0
                }
            },
            "subpaths": [
                {
                    "type": "circle",
                    "center": {
                        "x": -0,
                        "y": -0
                    },
                    "radius": 0.8
                }
            ]
        },
        {
            "type": "path",
            "stroke": {
                "color": {
                    "alpha": 255,
                    "red": 255,
                    "green": 255,
                    "blue": 255
                },
                "width": 0.2,
                "dashoffset": 0,
                "dashes": [
                    1.0,
                    0
                ],
                "cap": "butt",
                "join": "miter",
                "miter": 10.0
            },
            "fill": {
                "type": "solid",
                "color": {
                    "alpha": 255,
                    "red": 255,
                    "green": 255,
                    "blue": 255
                }
            },
            "subpaths": [
                {
                    "type": "text",
                    "text": "十",
                    "fontfamily": "Noto Sans SC",
                    "fontsize": 0.6,
                    "anchor": {
                        "x": 0.0,
                        "y": 0
                    },
                    "weight": "bold",
                    "slant": "normal",
                    "horizontalalign": "center",
                    "verticalalign": "middle",
                    "rotate": 0,
                    "ispath": false
                }
            ]
        }
    ]
}');

insert into sc_symbols(english, chinese, sym) values('1','1','
{
    "offset": {
        "x": 0,
        "y": 0
    },
    "size": 5,
    "shapes": [
        {
            "type": "path",
            "stroke": {
                "color": {
                    "alpha": 255,
                    "red": 0,
                    "green": 0,
                    "blue": 255
                },
                "width": 0.2,
                "dashoffset": 0,
                "dashes": [
                    1.0,
                    0
                ],
                "cap": "butt",
                "join": "miter",
                "miter": 10.0
            },
            "fill": {
                "type": "solid",
                "color": {
                    "alpha": 127,
                    "red": 255,
                    "green": 0,
                    "blue": 0
                }
            },
            "subpaths": [
                {
                    "type": "circle",
                    "center": {
                        "x": -0,
                        "y": -0
                    },
                    "radius": 0.8
                },
                {
                    "type": "text",
                    "text": "1",
                    "fontfamily": "SimSun",
                    "fontsize": 0.8,
                    "anchor": {
                        "x": 0.0,
                        "y": 0
                    },
                    "weight": "bold",
                    "slant": "normal",
                    "horizontalalign": "center",
                    "verticalalign": "middle",
                    "rotate": 0,
                    "ispath": true
                }
            ]
        }
    ]
}');

insert into sc_symbols(english, chinese, sym) values('1','一','
{
    "offset": {
        "x": 0,
        "y": 0
    },
    "size": 5,
    "shapes": [
        {
            "type": "path",
            "stroke": {
                "color": {
                    "alpha": 255,
                    "red": 0,
                    "green": 0,
                    "blue": 255
                },
                "width": 0.2,
                "dashoffset": 0,
                "dashes": [
                    1.0,
                    0
                ],
                "cap": "butt",
                "join": "miter",
                "miter": 10.0
            },
            "fill": {
                "type": "solid",
                "color": {
                    "alpha": 127,
                    "red": 255,
                    "green": 0,
                    "blue": 0
                }
            },
            "subpaths": [
                {
                    "type": "circle",
                    "center": {
                        "x": -0,
                        "y": -0
                    },
                    "radius": 0.8
                }
            ]
        },
        {
            "type": "path",
            "stroke": {
                "color": {
                    "alpha": 255,
                    "red": 255,
                    "green": 255,
                    "blue": 255
                },
                "width": 0.2,
                "dashoffset": 0,
                "dashes": [
                    1.0,
                    0
                ],
                "cap": "butt",
                "join": "miter",
                "miter": 10.0
            },
            "fill": {
                "type": "solid",
                "color": {
                    "alpha": 255,
                    "red": 255,
                    "green": 255,
                    "blue": 255
                }
            },
            "subpaths": [
                {
                    "type": "text",
                    "text": "一",
                    "fontfamily": "Noto Sans SC",
                    "fontsize": 0.6,
                    "anchor": {
                        "x": 0.0,
                        "y": 0
                    },
                    "weight": "bold",
                    "slant": "normal",
                    "horizontalalign": "center",
                    "verticalalign": "middle",
                    "rotate": 0,
                    "ispath": false
                }
            ]
        }
    ]
}');

insert into sc_symbols(english, chinese, sym) values('2','2','
{
    "offset": {
        "x": 0,
        "y": 0
    },
    "size": 5,
    "shapes": [
        {
            "type": "path",
            "stroke": {
                "color": {
                    "alpha": 255,
                    "red": 0,
                    "green": 0,
                    "blue": 255
                },
                "width": 0.2,
                "dashoffset": 0,
                "dashes": [
                    1.0,
                    0
                ],
                "cap": "butt",
                "join": "miter",
                "miter": 10.0
            },
            "fill": {
                "type": "solid",
                "color": {
                    "alpha": 127,
                    "red": 255,
                    "green": 0,
                    "blue": 0
                }
            },
            "subpaths": [
                {
                    "type": "circle",
                    "center": {
                        "x": -0,
                        "y": -0
                    },
                    "radius": 0.8
                },
                {
                    "type": "text",
                    "text": "2",
                    "fontfamily": "SimSun",
                    "fontsize": 0.8,
                    "anchor": {
                        "x": 0.0,
                        "y": 0
                    },
                    "weight": "bold",
                    "slant": "normal",
                    "horizontalalign": "center",
                    "verticalalign": "middle",
                    "rotate": 0,
                    "ispath": true
                }
            ]
        }
    ]
}');

insert into sc_symbols(english, chinese, sym) values('2','二','
{
    "offset": {
        "x": 0,
        "y": 0
    },
    "size": 5,
    "shapes": [
        {
            "type": "path",
            "stroke": {
                "color": {
                    "alpha": 255,
                    "red": 0,
                    "green": 0,
                    "blue": 255
                },
                "width": 0.2,
                "dashoffset": 0,
                "dashes": [
                    1.0,
                    0
                ],
                "cap": "butt",
                "join": "miter",
                "miter": 10.0
            },
            "fill": {
                "type": "solid",
                "color": {
                    "alpha": 127,
                    "red": 255,
                    "green": 0,
                    "blue": 0
                }
            },
            "subpaths": [
                {
                    "type": "circle",
                    "center": {
                        "x": -0,
                        "y": -0
                    },
                    "radius": 0.8
                }
            ]
        },
        {
            "type": "path",
            "stroke": {
                "color": {
                    "alpha": 255,
                    "red": 255,
                    "green": 255,
                    "blue": 255
                },
                "width": 0.2,
                "dashoffset": 0,
                "dashes": [
                    1.0,
                    0
                ],
                "cap": "butt",
                "join": "miter",
                "miter": 10.0
            },
            "fill": {
                "type": "solid",
                "color": {
                    "alpha": 255,
                    "red": 255,
                    "green": 255,
                    "blue": 255
                }
            },
            "subpaths": [
                {
                    "type": "text",
                    "text": "二",
                    "fontfamily": "Noto Sans SC",
                    "fontsize": 0.6,
                    "anchor": {
                        "x": 0.0,
                        "y": 0
                    },
                    "weight": "bold",
                    "slant": "normal",
                    "horizontalalign": "center",
                    "verticalalign": "middle",
                    "rotate": 0,
                    "ispath": false
                }
            ]
        }
    ]
}');

insert into sc_symbols(english, chinese, sym) values('3','3','
{
    "offset": {
        "x": 0,
        "y": 0
    },
    "size": 5,
    "shapes": [
        {
            "type": "path",
            "stroke": {
                "color": {
                    "alpha": 255,
                    "red": 0,
                    "green": 0,
                    "blue": 255
                },
                "width": 0.2,
                "dashoffset": 0,
                "dashes": [
                    1.0,
                    0
                ],
                "cap": "butt",
                "join": "miter",
                "miter": 10.0
            },
            "fill": {
                "type": "solid",
                "color": {
                    "alpha": 127,
                    "red": 255,
                    "green": 0,
                    "blue": 0
                }
            },
            "subpaths": [
                {
                    "type": "circle",
                    "center": {
                        "x": -0,
                        "y": -0
                    },
                    "radius": 0.8
                },
                {
                    "type": "text",
                    "text": "3",
                    "fontfamily": "SimSun",
                    "fontsize": 0.8,
                    "anchor": {
                        "x": 0.0,
                        "y": 0
                    },
                    "weight": "bold",
                    "slant": "normal",
                    "horizontalalign": "center",
                    "verticalalign": "middle",
                    "rotate": 0,
                    "ispath": true
                }
            ]
        }
    ]
}');

insert into sc_symbols(english, chinese, sym) values('3','三','
{
    "offset": {
        "x": 0,
        "y": 0
    },
    "size": 5,
    "shapes": [
        {
            "type": "path",
            "stroke": {
                "color": {
                    "alpha": 255,
                    "red": 0,
                    "green": 0,
                    "blue": 255
                },
                "width": 0.2,
                "dashoffset": 0,
                "dashes": [
                    1.0,
                    0
                ],
                "cap": "butt",
                "join": "miter",
                "miter": 10.0
            },
            "fill": {
                "type": "solid",
                "color": {
                    "alpha": 127,
                    "red": 255,
                    "green": 0,
                    "blue": 0
                }
            },
            "subpaths": [
                {
                    "type": "circle",
                    "center": {
                        "x": -0,
                        "y": -0
                    },
                    "radius": 0.8
                }
            ]
        },
        {
            "type": "path",
            "stroke": {
                "color": {
                    "alpha": 255,
                    "red": 255,
                    "green": 255,
                    "blue": 255
                },
                "width": 0.2,
                "dashoffset": 0,
                "dashes": [
                    1.0,
                    0
                ],
                "cap": "butt",
                "join": "miter",
                "miter": 10.0
            },
            "fill": {
                "type": "solid",
                "color": {
                    "alpha": 255,
                    "red": 255,
                    "green": 255,
                    "blue": 255
                }
            },
            "subpaths": [
                {
                    "type": "text",
                    "text": "三",
                    "fontfamily": "Noto Sans SC",
                    "fontsize": 0.6,
                    "anchor": {
                        "x": 0.0,
                        "y": 0
                    },
                    "weight": "bold",
                    "slant": "normal",
                    "horizontalalign": "center",
                    "verticalalign": "middle",
                    "rotate": 0,
                    "ispath": false
                }
            ]
        }
    ]
}');

insert into sc_symbols(english, chinese, sym) values('4','4','
{
    "offset": {
        "x": 0,
        "y": 0
    },
    "size": 5,
    "shapes": [
        {
            "type": "path",
            "stroke": {
                "color": {
                    "alpha": 255,
                    "red": 0,
                    "green": 0,
                    "blue": 255
                },
                "width": 0.2,
                "dashoffset": 0,
                "dashes": [
                    1.0,
                    0
                ],
                "cap": "butt",
                "join": "miter",
                "miter": 10.0
            },
            "fill": {
                "type": "solid",
                "color": {
                    "alpha": 127,
                    "red": 255,
                    "green": 0,
                    "blue": 0
                }
            },
            "subpaths": [
                {
                    "type": "circle",
                    "center": {
                        "x": -0,
                        "y": -0
                    },
                    "radius": 0.8
                },
                {
                    "type": "text",
                    "text": "4",
                    "fontfamily": "SimSun",
                    "fontsize": 0.8,
                    "anchor": {
                        "x": 0.0,
                        "y": 0
                    },
                    "weight": "bold",
                    "slant": "normal",
                    "horizontalalign": "center",
                    "verticalalign": "middle",
                    "rotate": 0,
                    "ispath": true
                }
            ]
        }
    ]
}');

insert into sc_symbols(english, chinese, sym) values('4','四','
{
    "offset": {
        "x": 0,
        "y": 0
    },
    "size": 5,
    "shapes": [
        {
            "type": "path",
            "stroke": {
                "color": {
                    "alpha": 255,
                    "red": 0,
                    "green": 0,
                    "blue": 255
                },
                "width": 0.2,
                "dashoffset": 0,
                "dashes": [
                    1.0,
                    0
                ],
                "cap": "butt",
                "join": "miter",
                "miter": 10.0
            },
            "fill": {
                "type": "solid",
                "color": {
                    "alpha": 127,
                    "red": 255,
                    "green": 0,
                    "blue": 0
                }
            },
            "subpaths": [
                {
                    "type": "circle",
                    "center": {
                        "x": -0,
                        "y": -0
                    },
                    "radius": 0.8
                }
            ]
        },
        {
            "type": "path",
            "stroke": {
                "color": {
                    "alpha": 255,
                    "red": 255,
                    "green": 255,
                    "blue": 255
                },
                "width": 0.2,
                "dashoffset": 0,
                "dashes": [
                    1.0,
                    0
                ],
                "cap": "butt",
                "join": "miter",
                "miter": 10.0
            },
            "fill": {
                "type": "solid",
                "color": {
                    "alpha": 255,
                    "red": 255,
                    "green": 255,
                    "blue": 255
                }
            },
            "subpaths": [
                {
                    "type": "text",
                    "text": "四",
                    "fontfamily": "Noto Sans SC",
                    "fontsize": 0.6,
                    "anchor": {
                        "x": 0.0,
                        "y": 0
                    },
                    "weight": "bold",
                    "slant": "normal",
                    "horizontalalign": "center",
                    "verticalalign": "middle",
                    "rotate": 0,
                    "ispath": false
                }
            ]
        }
    ]
}');

insert into sc_symbols(english, chinese, sym) values('5','5','
{
    "offset": {
        "x": 0,
        "y": 0
    },
    "size": 5,
    "shapes": [
        {
            "type": "path",
            "stroke": {
                "color": {
                    "alpha": 255,
                    "red": 0,
                    "green": 0,
                    "blue": 255
                },
                "width": 0.2,
                "dashoffset": 0,
                "dashes": [
                    1.0,
                    0
                ],
                "cap": "butt",
                "join": "miter",
                "miter": 10.0
            },
            "fill": {
                "type": "solid",
                "color": {
                    "alpha": 127,
                    "red": 255,
                    "green": 0,
                    "blue": 0
                }
            },
            "subpaths": [
                {
                    "type": "circle",
                    "center": {
                        "x": -0,
                        "y": -0
                    },
                    "radius": 0.8
                },
                {
                    "type": "text",
                    "text": "5",
                    "fontfamily": "SimSun",
                    "fontsize": 0.8,
                    "anchor": {
                        "x": 0.0,
                        "y": 0
                    },
                    "weight": "bold",
                    "slant": "normal",
                    "horizontalalign": "center",
                    "verticalalign": "middle",
                    "rotate": 0,
                    "ispath": true
                }
            ]
        }
    ]
}');

insert into sc_symbols(english, chinese, sym) values('5','五','
{
    "offset": {
        "x": 0,
        "y": 0
    },
    "size": 5,
    "shapes": [
        {
            "type": "path",
            "stroke": {
                "color": {
                    "alpha": 255,
                    "red": 0,
                    "green": 0,
                    "blue": 255
                },
                "width": 0.2,
                "dashoffset": 0,
                "dashes": [
                    1.0,
                    0
                ],
                "cap": "butt",
                "join": "miter",
                "miter": 10.0
            },
            "fill": {
                "type": "solid",
                "color": {
                    "alpha": 127,
                    "red": 255,
                    "green": 0,
                    "blue": 0
                }
            },
            "subpaths": [
                {
                    "type": "circle",
                    "center": {
                        "x": -0,
                        "y": -0
                    },
                    "radius": 0.8
                }
            ]
        },
        {
            "type": "path",
            "stroke": {
                "color": {
                    "alpha": 255,
                    "red": 255,
                    "green": 255,
                    "blue": 255
                },
                "width": 0.2,
                "dashoffset": 0,
                "dashes": [
                    1.0,
                    0
                ],
                "cap": "butt",
                "join": "miter",
                "miter": 10.0
            },
            "fill": {
                "type": "solid",
                "color": {
                    "alpha": 255,
                    "red": 255,
                    "green": 255,
                    "blue": 255
                }
            },
            "subpaths": [
                {
                    "type": "text",
                    "text": "五",
                    "fontfamily": "Noto Sans SC",
                    "fontsize": 0.6,
                    "anchor": {
                        "x": 0.0,
                        "y": 0
                    },
                    "weight": "bold",
                    "slant": "normal",
                    "horizontalalign": "center",
                    "verticalalign": "middle",
                    "rotate": 0,
                    "ispath": false
                }
            ]
        }
    ]
}');

insert into sc_symbols(english, chinese, sym) values('6','6','
{
    "offset": {
        "x": 0,
        "y": 0
    },
    "size": 5,
    "shapes": [
        {
            "type": "path",
            "stroke": {
                "color": {
                    "alpha": 255,
                    "red": 0,
                    "green": 0,
                    "blue": 255
                },
                "width": 0.2,
                "dashoffset": 0,
                "dashes": [
                    1.0,
                    0
                ],
                "cap": "butt",
                "join": "miter",
                "miter": 10.0
            },
            "fill": {
                "type": "solid",
                "color": {
                    "alpha": 127,
                    "red": 255,
                    "green": 0,
                    "blue": 0
                }
            },
            "subpaths": [
                {
                    "type": "circle",
                    "center": {
                        "x": -0,
                        "y": -0
                    },
                    "radius": 0.8
                },
                {
                    "type": "text",
                    "text": "5",
                    "fontfamily": "SimSun",
                    "fontsize": 0.8,
                    "anchor": {
                        "x": 0.0,
                        "y": 0
                    },
                    "weight": "bold",
                    "slant": "normal",
                    "horizontalalign": "center",
                    "verticalalign": "middle",
                    "rotate": 0,
                    "ispath": true
                }
            ]
        }
    ]
}');

insert into sc_symbols(english, chinese, sym) values('6','六','
{
    "offset": {
        "x": 0,
        "y": 0
    },
    "size": 5,
    "shapes": [
        {
            "type": "path",
            "stroke": {
                "color": {
                    "alpha": 255,
                    "red": 0,
                    "green": 0,
                    "blue": 255
                },
                "width": 0.2,
                "dashoffset": 0,
                "dashes": [
                    1.0,
                    0
                ],
                "cap": "butt",
                "join": "miter",
                "miter": 10.0
            },
            "fill": {
                "type": "solid",
                "color": {
                    "alpha": 127,
                    "red": 255,
                    "green": 0,
                    "blue": 0
                }
            },
            "subpaths": [
                {
                    "type": "circle",
                    "center": {
                        "x": -0,
                        "y": -0
                    },
                    "radius": 0.8
                }
            ]
        },
        {
            "type": "path",
            "stroke": {
                "color": {
                    "alpha": 255,
                    "red": 255,
                    "green": 255,
                    "blue": 255
                },
                "width": 0.2,
                "dashoffset": 0,
                "dashes": [
                    1.0,
                    0
                ],
                "cap": "butt",
                "join": "miter",
                "miter": 10.0
            },
            "fill": {
                "type": "solid",
                "color": {
                    "alpha": 255,
                    "red": 255,
                    "green": 255,
                    "blue": 255
                }
            },
            "subpaths": [
                {
                    "type": "text",
                    "text": "六",
                    "fontfamily": "Noto Sans SC",
                    "fontsize": 0.6,
                    "anchor": {
                        "x": 0.0,
                        "y": 0
                    },
                    "weight": "bold",
                    "slant": "normal",
                    "horizontalalign": "center",
                    "verticalalign": "middle",
                    "rotate": 0,
                    "ispath": false
                }
            ]
        }
    ]
}');

insert into sc_symbols(english, chinese, sym) values('7','7','
{
    "offset": {
        "x": 0,
        "y": 0
    },
    "size": 5,
    "shapes": [
        {
            "type": "path",
            "stroke": {
                "color": {
                    "alpha": 255,
                    "red": 0,
                    "green": 0,
                    "blue": 255
                },
                "width": 0.2,
                "dashoffset": 0,
                "dashes": [
                    1.0,
                    0
                ],
                "cap": "butt",
                "join": "miter",
                "miter": 10.0
            },
            "fill": {
                "type": "solid",
                "color": {
                    "alpha": 127,
                    "red": 255,
                    "green": 0,
                    "blue": 0
                }
            },
            "subpaths": [
                {
                    "type": "circle",
                    "center": {
                        "x": -0,
                        "y": -0
                    },
                    "radius": 0.8
                },
                {
                    "type": "text",
                    "text": "5",
                    "fontfamily": "SimSun",
                    "fontsize": 0.8,
                    "anchor": {
                        "x": 0.0,
                        "y": 0
                    },
                    "weight": "bold",
                    "slant": "normal",
                    "horizontalalign": "center",
                    "verticalalign": "middle",
                    "rotate": 0,
                    "ispath": true
                }
            ]
        }
    ]
}');

insert into sc_symbols(english, chinese, sym) values('7','七','
{
    "offset": {
        "x": 0,
        "y": 0
    },
    "size": 5,
    "shapes": [
        {
            "type": "path",
            "stroke": {
                "color": {
                    "alpha": 255,
                    "red": 0,
                    "green": 0,
                    "blue": 255
                },
                "width": 0.2,
                "dashoffset": 0,
                "dashes": [
                    1.0,
                    0
                ],
                "cap": "butt",
                "join": "miter",
                "miter": 10.0
            },
            "fill": {
                "type": "solid",
                "color": {
                    "alpha": 127,
                    "red": 255,
                    "green": 0,
                    "blue": 0
                }
            },
            "subpaths": [
                {
                    "type": "circle",
                    "center": {
                        "x": -0,
                        "y": -0
                    },
                    "radius": 0.8
                }
            ]
        },
        {
            "type": "path",
            "stroke": {
                "color": {
                    "alpha": 255,
                    "red": 255,
                    "green": 255,
                    "blue": 255
                },
                "width": 0.2,
                "dashoffset": 0,
                "dashes": [
                    1.0,
                    0
                ],
                "cap": "butt",
                "join": "miter",
                "miter": 10.0
            },
            "fill": {
                "type": "solid",
                "color": {
                    "alpha": 255,
                    "red": 255,
                    "green": 255,
                    "blue": 255
                }
            },
            "subpaths": [
                {
                    "type": "text",
                    "text": "七",
                    "fontfamily": "Noto Sans SC",
                    "fontsize": 0.6,
                    "anchor": {
                        "x": 0.0,
                        "y": 0
                    },
                    "weight": "bold",
                    "slant": "normal",
                    "horizontalalign": "center",
                    "verticalalign": "middle",
                    "rotate": 0,
                    "ispath": false
                }
            ]
        }
    ]
}');

insert into sc_symbols(english, chinese, sym) values('8','8','
{
    "offset": {
        "x": 0,
        "y": 0
    },
    "size": 5,
    "shapes": [
        {
            "type": "path",
            "stroke": {
                "color": {
                    "alpha": 255,
                    "red": 0,
                    "green": 0,
                    "blue": 255
                },
                "width": 0.2,
                "dashoffset": 0,
                "dashes": [
                    1.0,
                    0
                ],
                "cap": "butt",
                "join": "miter",
                "miter": 10.0
            },
            "fill": {
                "type": "solid",
                "color": {
                    "alpha": 127,
                    "red": 255,
                    "green": 0,
                    "blue": 0
                }
            },
            "subpaths": [
                {
                    "type": "circle",
                    "center": {
                        "x": -0,
                        "y": -0
                    },
                    "radius": 0.8
                },
                {
                    "type": "text",
                    "text": "5",
                    "fontfamily": "SimSun",
                    "fontsize": 0.8,
                    "anchor": {
                        "x": 0.0,
                        "y": 0
                    },
                    "weight": "bold",
                    "slant": "normal",
                    "horizontalalign": "center",
                    "verticalalign": "middle",
                    "rotate": 0,
                    "ispath": true
                }
            ]
        }
    ]
}');

insert into sc_symbols(english, chinese, sym) values('8','八','
{
    "offset": {
        "x": 0,
        "y": 0
    },
    "size": 5,
    "shapes": [
        {
            "type": "path",
            "stroke": {
                "color": {
                    "alpha": 255,
                    "red": 0,
                    "green": 0,
                    "blue": 255
                },
                "width": 0.2,
                "dashoffset": 0,
                "dashes": [
                    1.0,
                    0
                ],
                "cap": "butt",
                "join": "miter",
                "miter": 10.0
            },
            "fill": {
                "type": "solid",
                "color": {
                    "alpha": 127,
                    "red": 255,
                    "green": 0,
                    "blue": 0
                }
            },
            "subpaths": [
                {
                    "type": "circle",
                    "center": {
                        "x": -0,
                        "y": -0
                    },
                    "radius": 0.8
                }
            ]
        },
        {
            "type": "path",
            "stroke": {
                "color": {
                    "alpha": 255,
                    "red": 255,
                    "green": 255,
                    "blue": 255
                },
                "width": 0.2,
                "dashoffset": 0,
                "dashes": [
                    1.0,
                    0
                ],
                "cap": "butt",
                "join": "miter",
                "miter": 10.0
            },
            "fill": {
                "type": "solid",
                "color": {
                    "alpha": 255,
                    "red": 255,
                    "green": 255,
                    "blue": 255
                }
            },
            "subpaths": [
                {
                    "type": "text",
                    "text": "八",
                    "fontfamily": "Noto Sans SC",
                    "fontsize": 0.6,
                    "anchor": {
                        "x": 0.0,
                        "y": 0
                    },
                    "weight": "bold",
                    "slant": "normal",
                    "horizontalalign": "center",
                    "verticalalign": "middle",
                    "rotate": 0,
                    "ispath": false
                }
            ]
        }
    ]
}');

insert into sc_symbols(english, chinese, sym) values('9','9','
{
    "offset": {
        "x": 0,
        "y": 0
    },
    "size": 5,
    "shapes": [
        {
            "type": "path",
            "stroke": {
                "color": {
                    "alpha": 255,
                    "red": 0,
                    "green": 0,
                    "blue": 255
                },
                "width": 0.2,
                "dashoffset": 0,
                "dashes": [
                    1.0,
                    0
                ],
                "cap": "butt",
                "join": "miter",
                "miter": 10.0
            },
            "fill": {
                "type": "solid",
                "color": {
                    "alpha": 127,
                    "red": 255,
                    "green": 0,
                    "blue": 0
                }
            },
            "subpaths": [
                {
                    "type": "circle",
                    "center": {
                        "x": -0,
                        "y": -0
                    },
                    "radius": 0.8
                },
                {
                    "type": "text",
                    "text": "5",
                    "fontfamily": "SimSun",
                    "fontsize": 0.8,
                    "anchor": {
                        "x": 0.0,
                        "y": 0
                    },
                    "weight": "bold",
                    "slant": "normal",
                    "horizontalalign": "center",
                    "verticalalign": "middle",
                    "rotate": 0,
                    "ispath": true
                }
            ]
        }
    ]
}');

insert into sc_symbols(english, chinese, sym) values('9','九','
{
    "offset": {
        "x": 0,
        "y": 0
    },
    "size": 5,
    "shapes": [
        {
            "type": "path",
            "stroke": {
                "color": {
                    "alpha": 255,
                    "red": 0,
                    "green": 0,
                    "blue": 255
                },
                "width": 0.2,
                "dashoffset": 0,
                "dashes": [
                    1.0,
                    0
                ],
                "cap": "butt",
                "join": "miter",
                "miter": 10.0
            },
            "fill": {
                "type": "solid",
                "color": {
                    "alpha": 127,
                    "red": 255,
                    "green": 0,
                    "blue": 0
                }
            },
            "subpaths": [
                {
                    "type": "circle",
                    "center": {
                        "x": -0,
                        "y": -0
                    },
                    "radius": 0.8
                }
            ]
        },
        {
            "type": "path",
            "stroke": {
                "color": {
                    "alpha": 255,
                    "red": 255,
                    "green": 255,
                    "blue": 255
                },
                "width": 0.2,
                "dashoffset": 0,
                "dashes": [
                    1.0,
                    0
                ],
                "cap": "butt",
                "join": "miter",
                "miter": 10.0
            },
            "fill": {
                "type": "solid",
                "color": {
                    "alpha": 255,
                    "red": 255,
                    "green": 255,
                    "blue": 255
                }
            },
            "subpaths": [
                {
                    "type": "text",
                    "text": "九",
                    "fontfamily": "Noto Sans SC",
                    "fontsize": 0.6,
                    "anchor": {
                        "x": 0.0,
                        "y": 0
                    },
                    "weight": "bold",
                    "slant": "normal",
                    "horizontalalign": "center",
                    "verticalalign": "middle",
                    "rotate": 0,
                    "ispath": false
                }
            ]
        }
    ]
}');

insert into sc_symbols(english, chinese, sym) values('arc3points','三点定弧','
{
    "offset": {
        "x": 0,
        "y": 0
    },
    "size": 5,
    "shapes": [
        {
            "type": "path",
            "stroke": {
                "color": {
                    "alpha": 255,
                    "red": 127,
                    "green": 127,
                    "blue": 127
                },
                "width": 0.3,
                "dashoffset": 0,
                "dashes": [
                    1.0,
                    0
                ],
                "cap": "butt",
                "join": "miter",
                "miter": 10.0
            },
            "fill": {
                "type": "solid",
                "color": {
                    "alpha": 255,
                    "red": 255,
                    "green": 255,
                    "blue": 127
                }
            },
            "subpaths": [
                {
                    "type": "arc3points",
                    "offset": {
                        "x": 0,
                        "y": 0
                    },
                    "rotate": 0,
                    "begin": {
                        "x": -0.8,
                        "y": 0
                    },
                    "middle": {
                        "x": 0,
                        "y": 0.8
                    },
                    "end": {
                        "x": 0.8,
                        "y": 0
                    }
                },
                {
                    "type": "arc3points",
                    "offset": {
                        "x": 0,
                        "y": 0
                    },
                    "rotate": 0,
                    "begin": {
                        "x": -0.8,
                        "y": 0
                    },
                    "middle": {
                        "x": 0,
                        "y": 0.2
                    },
                    "end": {
                        "x": 0.8,
                        "y": 0
                    }
                }
            ]
        }
    ]
}');

insert into sc_symbols(english, chinese, sym) values('arc','弧','
{
    "offset": {
        "x": 0,
        "y": 0
    },
    "size": 5,
    "shapes": [
        {
            "type": "path",
            "stroke": {
                "color": {
                    "alpha": 255,
                    "red": 0,
                    "green": 0,
                    "blue": 0
                },
                "width": 0.3,
                "dashoffset": 0,
                "dashes": [
                    1.0,
                    0
                ],
                "cap": "butt",
                "join": "miter",
                "miter": 10.0
            },
            "fill": {
                "type": "solid",
                "color": {
                    "alpha": 127,
                    "red": 255,
                    "green": 0,
                    "blue": 0
                }
            },
            "subpaths": [
                {
                    "type": "arc",
                    "center": {
                        "x": 0,
                        "y": 0
                    },
                    "xradius": 0.8,
                    "yradius": 0.4,
                    "rotate": 0,
                    "startangle": 0,
                    "endangle": 180
                }
            ]
        }
    ]
}');

insert into sc_symbols(english, chinese, sym) values('chord','弦','
{
    "offset": {
        "x": 0,
        "y": 0
    },
    "size": 5,
    "shapes": [
        {
            "type": "path",
            "stroke": {
                "color": {
                    "alpha": 255,
                    "red": 0,
                    "green": 0,
                    "blue": 0
                },
                "width": 0.3,
                "dashoffset": 0,
                "dashes": [
                    1.0,
                    0
                ],
                "cap": "butt",
                "join": "miter",
                "miter": 10.0
            },
            "fill": {
                "type": "solid",
                "color": {
                    "alpha": 127,
                    "red": 255,
                    "green": 0,
                    "blue": 0
                }
            },
            "subpaths": [
                {
                    "type": "chord",
                    "center": {
                        "x": 0,
                        "y": 0
                    },
                    "xradius": 0.8,
                    "yradius": 0.8,
                    "rotate": 0,
                    "startangle": -180,
                    "endangle": -90
                }
            ],
            "closed": true
        }
    ]
}');

insert into sc_symbols(english, chinese, sym) values('circle','圆','
{
    "offset": {
        "x": 0,
        "y": 0
    },
    "size": 5,
    "shapes": [
        {
            "type": "path",
            "stroke": {
                "color": {
                    "alpha": 255,
                    "red": 0,
                    "green": 0,
                    "blue": 0
                },
                "width": 0.3,
                "dashoffset": 0,
                "dashes": [
                    1.0,
                    0
                ],
                "cap": "butt",
                "join": "miter",
                "miter": 10.0
            },
            "fill": {
                "type": "solid",
                "color": {
                    "alpha": 127,
                    "red": 255,
                    "green": 255,
                    "blue": 0
                }
            },
            "subpaths": [
                {
                    "type": "circle",
                    "center": {
                        "x": 0,
                        "y": 0
                    },
                    "radius": 0.8
                }
            ]
        }
    ]
}');

insert into sc_symbols(english, chinese, sym) values('concentric circles','同心圆','
{
    "offset": {
        "x": 0,
        "y": 0
    },
    "size": 5,
    "shapes": [
        {
            "type": "path",
            "stroke": {
                "color": {
                    "alpha": 255,
                    "red": 0,
                    "green": 0,
                    "blue": 0
                },
                "width": 0.3,
                "dashoffset": 0,
                "dashes": [
                    1.0,
                    0
                ],
                "cap": "butt",
                "join": "miter",
                "miter": 10.0
            },
            "fill": {
                "type": "solid",
                "color": {
                    "alpha": 255,
                    "red": 255,
                    "green": 0,
                    "blue": 0
                }
            },
            "subpaths": [
                {
                    "type": "circle",
                    "center": {
                        "x": -0,
                        "y": -0
                    },
                    "radius": 0.8
                },
                {
                    "type": "circle",
                    "center": {
                        "x": -0,
                        "y": -0
                    },
                    "radius": 0.5
                }
            ],
            "closed": true
        }
    ]
}');

insert into sc_symbols(english, chinese, sym) values('ellipse','椭圆','
{
    "offset": {
        "x": 0,
        "y": 0
    },
    "size": 5,
    "shapes": [
        {
            "type": "path",
            "stroke": {
                "color": {
                    "alpha": 255,
                    "red": 0,
                    "green": 0,
                    "blue": 0
                },
                "width": 0.3,
                "dashoffset": 0,
                "dashes": [
                    1.0,
                    0
                ],
                "cap": "butt",
                "join": "miter",
                "miter": 10.0
            },
            "fill": {
                "type": "solid",
                "color": {
                    "alpha": 127,
                    "red": 255,
                    "green": 0,
                    "blue": 0
                }
            },
            "subpaths": [
                {
                    "type": "ellipse",
                    "center": {
                        "x": 0,
                        "y": 0
                    },
                    "xradius": 0.8,
                    "yradius": 0.4,
                    "rotate": 45
                }
            ]
        }
    ]
}');

insert into sc_symbols(english, chinese, sym) values('linestring','折线','
{
    "offset": {
        "x": 0.0,
        "y": 0
    },
    "size": 5,
    "shapes": [
        {
            "type": "path",
            "stroke": {
                "color": {
                    "alpha": 255,
                    "red": 0,
                    "green": 0,
                    "blue": 0
                },
                "width": 0.2,
                "dashoffset": 0,
                "dashes": [
                    1.0,
                    0
                ],
                "cap": "round",
                "join": "round",
                "miter": 10.0
            },
            "fill": {
                "type": "solid",
                "color": {
                    "alpha": 0,
                    "red": 255,
                    "green": 0,
                    "blue": 0
                }
            },
            "subpaths": [
                {
                    "type": "linestring",
                    "points": [
                        {
                            "x": -0.7,
                            "y": 0.35
                        },
                        {
                            "x": -0.35,
                            "y": -0.35
                        },
                        {
                            "x": 0,
                            "y": 0.35
                        },
                        {
                            "x": 0.35,
                            "y": -0.35
                        },
                        {
                            "x": 0.7,
                            "y": 0.35
                        }
                    ]
                }
            ],
            "closed": true
        }
    ]
}');

insert into sc_symbols(english, chinese, sym) values('pie','扇形','
{
    "offset": {
        "x": 0,
        "y": 0
    },
    "size": 5,
    "shapes": [
        {
            "type": "path",
            "stroke": {
                "color": {
                    "alpha": 255,
                    "red": 0,
                    "green": 0,
                    "blue": 0
                },
                "width": 0.3,
                "dashoffset": 0,
                "dashes": [
                    1.0,
                    0
                ],
                "cap": "butt",
                "join": "miter",
                "miter": 10.0
            },
            "fill": {
                "type": "solid",
                "color": {
                    "alpha": 127,
                    "red": 255,
                    "green": 0,
                    "blue": 0
                }
            },
            "subpaths": [
                {
                    "type": "pie",
                    "center": {
                        "x": 0,
                        "y": 0
                    },
                    "xradius": 0.8,
                    "yradius": 0.8,
                    "rotate": 0,
                    "startangle": -180,
                    "endangle": -90
                }
            ],
            "closed": true
        }
    ]
}');

insert into sc_symbols(english, chinese, sym) values('polygon','多边形','
{
    "offset": {
        "x": 0,
        "y": 0
    },
    "size": 5,
    "shapes": [
        {
            "type": "path",
            "stroke": {
                "color": {
                    "alpha": 255,
                    "red": 0,
                    "green": 0,
                    "blue": 0
                },
                "width": 0.2,
                "dashoffset": 0,
                "dashes": [
                    1.0,
                    0
                ],
                "cap": "round",
                "join": "round",
                "miter": 10.0
            },
            "fill": {
                "type": "solid",
                "color": {
                    "alpha": 255,
                    "red": 255,
                    "green": 0,
                    "blue": 0
                }
            },
            "subpaths": [
                {
                    "type": "polygon",
                    "points": [
                        {
                            "x": -0.7,
                            "y": 0.35
                        },
                        {
                            "x": -0.35,
                            "y": -0.35
                        },
                        {
                            "x": 0.35,
                            "y": -0.35
                        },
                        {
                            "x": 0.7,
                            "y": 0.35
                        }
                    ]
                }
            ],
            "closed": true
        }
    ]
}');

insert into sc_symbols(english, chinese, sym) values('provincial capital','首府','
{
    "offset": {
        "x": 0,
        "y": 0
    },
    "size": 5,
    "shapes": [
        {
            "type": "path",
            "stroke": {
                "color": {
                    "alpha": 255,
                    "red": 255,
                    "green": 0,
                    "blue": 0
                },
                "width": 1,
                "dashoffset": 0,
                "dashes": [
                    1.0,
                    0
                ],
                "cap": "butt",
                "join": "miter",
                "miter": 10.0
            },
            "fill": {
                "type": "solid",
                "color": {
                    "alpha": 0,
                    "red": 255,
                    "green": 255,
                    "blue": 255
                }
            },
            "subpaths": [
                {
                    "type": "circle",
                    "center": {
                        "x": 0,
                        "y": 0
                    },
                    "radius": 0.8
                }
            ]
        },
        {
            "type": "path",
            "stroke": {
                "color": {
                    "alpha": 255,
                    "red": 255,
                    "green": 0,
                    "blue": 0
                },
                "width": 0.2,
                "dashoffset": 0,
                "dashes": [
                    1.0,
                    0
                ],
                "cap": "butt",
                "join": "miter",
                "miter": 10.0
            },
            "fill": {
                "type": "solid",
                "color": {
                    "alpha": 255,
                    "red": 255,
                    "green": 0,
                    "blue": 0
                }
            },
            "subpaths": [
                {
                    "type": "star",
                    "center": {
                        "x": -0,
                        "y": -0
                    },
                    "outerradius": 0.8,
                    "innerradius": 0.32,
                    "rotate": 0,
                    "numedges": 5
                }
            ],
            "closed": true
        }
    ]
}');

insert into sc_symbols(english, chinese, sym) values('solid fill','实心填充','
{
    "offset": {
        "x": 0,
        "y": 0
    },
    "size": 5,
    "shapes": [
        {
            "type": "systemfill",
            "fill": {
                "type": "solid",
                "color": {
                    "alpha": 255,
                    "red": 255,
                    "green": 0,
                    "blue": 0
                }
            }
        }
    ]
}');

insert into sc_symbols(english, chinese, sym) values('solid line','实线','
{
    "offset": {
        "x": 0,
        "y": 0
    },
    "size": 50,
    "shapes": [
        {
            "type": "systemline",
            "stroke": {
                "color": {
                    "alpha": 255,
                    "red": 0,
                    "green": 0,
                    "blue": 0
                },
                "width": 0.5,
                "dashoffset": 0,
                "dashes": [
                    3.0,
                    1,
                    1,
                    1
                ],
                "cap": "butt",
                "join": "miter",
                "miter": 10.0
            }
        }
    ]
}');

insert into sc_symbols(english, chinese, sym) values('square','正方形','
{
    "offset": {
        "x": 0,
        "y": 0
    },
    "size": 5,
    "shapes": [
        {
            "type": "path",
            "stroke": {
                "color": {
                    "alpha": 255,
                    "red": 255,
                    "green": 0,
                    "blue": 0
                },
                "width": 0.2,
                "dashoffset": 0,
                "dashes": [
                    1.0,
                    0
                ],
                "cap": "butt",
                "join": "miter",
                "miter": 10.0
            },
            "fill": {
                "type": "solid",
                "color": {
                    "alpha": 127,
                    "red": 255,
                    "green": 255,
                    "blue": 0
                }
            },
            "subpaths": [
                {
                    "type": "regularpolygon",
                    "center": {
                        "x": -0,
                        "y": -0
                    },
                    "radius": 0.79,
                    "rotate": 0,
                    "numedges": 4
                }
            ],
            "closed": true
        }
    ]
}');

insert into sc_symbols(english, chinese, sym) values('star','五角星','
{
    "offset": {
        "x": 0,
        "y": 0
    },
    "size": 5,
    "shapes": [
        {
            "type": "path",
            "stroke": {
                "color": {
                    "alpha": 255,
                    "red": 255,
                    "green": 0,
                    "blue": 0
                },
                "width": 0.2,
                "dashoffset": 0,
                "dashes": [
                    1.0,
                    0
                ],
                "cap": "butt",
                "join": "miter",
                "miter": 10.0
            },
            "fill": {
                "type": "solid",
                "color": {
                    "alpha": 255,
                    "red": 255,
                    "green": 0,
                    "blue": 0
                }
            },
            "subpaths": [
                {
                    "type": "star",
                    "center": {
                        "x": -0,
                        "y": -0
                    },
                    "outerradius": 0.79,
                    "innerradius": 0.3,
                    "rotate": 0,
                    "numedges": 5
                }
            ],
            "closed": true
        }
    ]
}');

insert into sc_symbols(english, chinese, sym) values('triangle','三角形','
{
    "offset": {
        "x": 0,
        "y": 0
    },
    "size": 5,
    "shapes": [
        {
            "type": "path",
            "stroke": {
                "color": {
                    "alpha": 255,
                    "red": 255,
                    "green": 0,
                    "blue": 0
                },
                "width": 0.2,
                "dashoffset": 0,
                "dashes": [
                    1.0,
                    0
                ],
                "cap": "butt",
                "join": "miter",
                "miter": 10.0
            },
            "fill": {
                "type": "solid",
                "color": {
                    "alpha": 127,
                    "red": 255,
                    "green": 255,
                    "blue": 0
                }
            },
            "subpaths": [
                {
                    "type": "regularpolygon",
                    "center": {
                        "x": -0,
                        "y": -0
                    },
                    "radius": 0.79,
                    "rotate": 0,
                    "numedges": 3
                }
            ],
            "closed": true
        }
    ]
}');

-- sqlcarto administrate module

drop table if exists sc_server_nodes;
create table sc_server_nodes(
    id varchar(32) not null,
    max_user_count  integer not null default 200,          -- each node can afford service for no more than 200 users 
    server_url varchar(1024),                              -- node service url for sqlcarto server
    db_host varchar(16) not null,                          -- host or ip
    db_storage_size float8 not null default 20000,         -- available space for database , unit: mega bytes
    db_reserved_factor float8 not null default 0.2,        -- if db storage occupied than (db_storage_size * (1-db_reserved_factor)), no operation can be done in this node
    last_operate_time timestamp default now() not null
);


-- 
create or replace function sc_add_node( maxuser float8, serverurl varchar, 
    dbhost varchar, dbmaxsize float8, dbreservfact float8) 
returns varchar as 
$$
declare
    nodeid varchar;
begin
    nodeid := sc_uuid();
    insert into sc_server_nodes(id,max_user_count, server_url, db_host,db_storage_size,db_reserved_factor) 
        values (nodeid,maxuser,serverurl, dbhost,dbmaxsize,dbreservfact);
    return nodeid;
end;
$$ language 'plpgsql';


drop table if exists sc_user_types;
create table sc_user_types(
    id integer not null unique,
    type_name varchar(64)
);
insert into sc_user_types(id, type_name) values
    (0, 'Adminstrator'),
    (1, 'Normal user'),
    (2, 'Guest');

drop table if exists sc_users;
create table sc_users(
    id varchar(32) primary key default sc_uuid() not null,
    user_name varchar(128) unique not null,
    password varchar(128) not null,
    user_type integer not null default 1,
    salt varchar(6) not null,
    verify_code varchar(6) default '',
    verify_code_gen_time timestamp not null default '1970-01-01'::timestamp,
    verify_code_valid_time interval default '10 minutes',
    token varchar(256) not null default '',
    token_gen_time timestamp null default now(),
    token_valid_time interval default '5 minutes',
    activated boolean default false not null,
    db_size float not null default 20000,                           -- 
    create_time timestamp default now()
);


create or replace function sc_user_exist(username varchar) returns boolean as 
$$
    select count(1) = 1 from sc_users where user_name = $1;
$$ language 'sql';


create or replace function sc_user_create(username varchar, password varchar, usertype integer) returns varchar as 
$$
declare
    id varchar;
    sqlstr text;
    salt varchar;
begin
    id := sc_uuid();
    salt := sc_generate_code(6);
    sqlstr := 'insert into sc_users(id,user_name,password,user_type,salt) values(' 
        || quote_literal(id) || ','
        || quote_literal(username) || ','
        || quote_literal(md5(password || salt)) || ','
        || usertype || ','
        || quote_literal(salt)
    || ')';
    execute sqlstr;
    return id;
end;
$$ language 'plpgsql';


create or replace function sc_user_is_activated(username varchar) returns boolean as 
$$
    select activated from sc_users where user_name = $1;
$$ language 'sql';

create or replace function sc_user_set_activate_by_id(userid varchar, isactivated boolean) returns varchar as 
$$
    update sc_users set activated = $2 where id = $1;
    select $1;
$$ language 'sql';

create or replace function sc_user_create_admin(username varchar, password varchar) returns varchar as 
$$
    select sc_user_set_activate_by_id(sc_user_create($1,$2,0),true);
$$ language 'sql';


create or replace function sc_user_get_id_by_name(username varchar) returns varchar as 
$$
    select id from sc_users where user_name = $1;
$$ language 'sql';



select sc_user_create_admin('pcwang','123456');





--

create table sc_services(
    id varchar(32) default sc_uuid() not null,
    request_type varchar unique not null,
    function_name varchar unique not null
    --,need_privilege_check boolean not null default true
);

--
--  request:
--      {
--          "type": "<request_type>",
--          "data": {
--              
--          }
--      }
create or replace function sc_service_run(request jsonb) returns jsonb as 
$$
declare
    typestr varchar;
    funcname varchar;
    sqlstr text;
    myrec record;
    response jsonb;
begin
    typestr := request->>'type';
    select function_name into funcname from sc_services where request_type = request->>'type';
    sqlstr := 'select ' || funcname || '(' || quote_literal(request::text) || '::jsonb)';
    execute sqlstr into response; 
    return response;
end;
$$ language 'plpgsql';


create or replace function sc_verify_code_is_expired(username varchar) returns boolean as 
$$
    select 
        (verify_code_gen_time + verify_code_valid_time < now()) 
    from 
        sc_users 
    where 
        user_name = $1
$$ language 'sql';



--      {
--          "type": "USER_GET_VERIFY_CODE",
--          "data": {
--              "username": "wang_wang_lao@163.com"
--          }
--      }
insert into sc_services(request_type, function_name) values('USER_GET_VERIFY_CODE','sc_user_get_verify_code');
create or replace function sc_user_get_verify_code(request jsonb) returns jsonb as 
$$
declare
    code varchar;
    ok boolean;
begin
    code := sc_generate_code(6);
    if not sc_user_exist(request->'data'->>'username') then 
        perform sc_user_create(request->'data'->>'username', '',1);
    end if;

    if not sc_verify_code_is_expired(request->'data'->>'username') then 
        select verify_code into code from sc_users where user_name = (request->'data'->>'username');
        return jsonb_build_object(
            'success', true,
            'message', 'Verify code has been sent to ' || (request->'data'->>'username')
        );
    end if;

    update sc_users 
    set 
        verify_code = code,
        verify_code_gen_time = now()
    where 
        user_name = (request->'data'->>'username');

    ok := sc_send_mail( request->'data'->>'username', 'verify code', code ) ;
    if ok then 
        return jsonb_build_object(
            'success', ok,
            'message', 'Verify code has been sent to ' || (request->'data'->>'username')
        );  
    end if;

    return jsonb_build_object(
        'success', ok,
        'message', 'Failed to send verify code'
    );
    
end;
$$ language 'plpgsql';

-- select sc_service_run(
--     '{
--          "type": "USER_GET_VERIFY_CODE",
--          "data": {
--              "username": ""
--          }
--      }'::jsonb
-- );


--      {
--          "type": "USER_CREATE",
--          "data": {
--              "username": "",
--              "password": "",
--              "verify_code": ""
--          }
--      }
delete from sc_services where request_type = 'USER_CREATE';
insert into sc_services(request_type, function_name) values('USER_CREATE','sc_user_create');
create or replace function sc_user_create(request jsonb) returns jsonb as 
$$
declare
    sqlstr text;
    userid varchar;
    username varchar;
begin
    username := (request->'data'->>'username');
    if sc_user_exist(username) and sc_user_is_activated(username) then 
        return jsonb_build_object(
            'success', false,
            'message', 'User exist! Please select another username.'
        );
    end if;
    
    userid := sc_user_get_id_by_name(username);
    perform sc_user_set_activate_by_id(userid, true);
    execute 'create user  sc_user_' || userid ;
    return jsonb_build_object(
        'success', true,
        'message', 'User has been created!'
    );
end;
$$
language 'plpgsql';
